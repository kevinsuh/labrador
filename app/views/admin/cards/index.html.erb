<!-- search functionality -->
<div class="row filter_row">
	<h2 class="filter_title">Filter Search:</h2>
	<div class="col-xs-4">
		<%= render 'search_filter' %>
	</div>
</div>

<!-- card display -->
<% @cards_data.each do |key, card_data| %>
	<% 
	card          = card_data[:card]
	relationships = card_data[:relationships]
	occasions     = card_data[:occasions]
	flavors       = card_data[:flavors]
	vendor 		 		= card_data[:vendor]
	card_vendor 	= card_data[:card_vendor]

	vendor_id = vendor ? vendor.id : 0

	# only one card_image for now
	card_images		= card_data[:card_images]
	card_image 		= card_images.first
	%>
	<div class="row card_admin_row">
		<h1 class="card_id">Card ID: <%=card.id%></h1>
		<%= form_for([:admin, card], html: {multipart: true}) do |f| %>
		<aside class="col-xs-4">
			<% if false %>
			<% card_images.each do |card_image| %>
				<span> <%= if card_image.picture?
					image_tag(card_image.picture.url, class: "card_image") 
				end %></span>
			<% end %>
			<% end %>

			<span><%= 
			if card_image && card_image.picture?
				image_tag(card_image.picture.url, class: "card_image")
			end %></span>
			<span class="picture">
				<%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png', class: "card_image_upload" %>
			</span>

		</aside>
		<div class ="col-xs-8 card_options">
			<div class="relationship_checkbox">
				<h5>Recipients:</h5>
				<% @relationships.each do |relationship| %>
					<% checked = relationships.ids.include? relationship.id %>
					<%= f.label "#{key}_relationships_#{relationship.id}", relationship.name %>	
					<%= f.check_box :relationships, {multiple: true, checked: checked, id: "card_#{key}_relationships_#{relationship.id}"}, relationship.id, nil  %> |
				<% end %>
			</div>
			<hr class="category_separator">
			<div class="occasion_checkbox">
				<h5>Occasions:</h5>
				<% @occasions.each do |occasion| %>
					<% checked = occasions.ids.include? occasion.id %>
					<%= f.label "#{key}_occasions_#{occasion.id}", occasion.name %>
					<%= f.check_box :occasions, {multiple: true, checked: checked, id: "card_#{key}_occasions_#{occasion.id}"}, occasion.id, nil %> |
				<% end %>
			</div>
			<hr class="category_separator">
			<div class="flavor_checkbox">
				<h5>Flavors:</h5>
				<% @flavors.each do |flavor| %>
					<% checked = flavors.ids.include? flavor.id %>
					<%= f.label "#{key}_flavors_#{flavor.id}", flavor.name %>
					<%= f.check_box :flavors, {multiple: true, checked: checked, id: "card_#{key}_flavors_#{flavor.id}"}, flavor.id, nil %> |
				<% end %>
			</div>
			<hr class="category_separator">
			<div class="vendor_select">
				<h5>Vendor:</h5>
				
				<%= f.select(:vendor, Vendor.all.collect { |v| [v.name, v.id] }, selected: vendor_id, include_blank: true ) %>
				<div style="display: inline-block; font-weight: bold; font-size: 16px; margin-left: 4em;">
					OR
				</div>
				<div style="display: inline-block; margin-left: 4em;">
					<%= f.label :new_vendor, "New Vendor:" %>
					<%= text_field(:card, :new_vendor, class: "new_vendor_field") %>
				</div>
				<div style="margin-top: 15px;">
					<%= f.label :vendor_url, "Vendor URL:" %>
					<%= text_field(:card, :vendor_url, class: "new_vendor_field") %>
				</div>
			</div>
			<hr class="category_separator">
			<div class="submit">
				<%= f.submit "Update Card", class: "btn btn-primary" %>
			</div>
			<% end %>
		</div>

		<% if false %>
		relationships: <%= relationships.ids %>
		occasions: <%= occasions.ids %>
		flavors: <%= flavors.ids %>

		<% relationships.each do |relationship| %>
			<span><%= relationship.name %> | <%= relationship.id %>, </span>
		<% end %>
		<br>
		<% occasions.each do |occasion| %>
			<span><%= occasion.name %> | <%= occasion.id %>,</span>
		<% end %>
		<br>
		<% flavors.each do |flavor| %>
			<span><%= flavor.name %> | <%= flavor.id %>,</span>
		<% end %>
		<% end %>
		
	</div>
	<hr>
<% end %>

<!-- jquery test to make sure picture size is reasonable -->
<script type="text/javascript">
  $('.card_image').bind('change', function() {
    size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 5) {
      alert('Maximum file size is 5MB. Please choose a smaller file.');
    }
});
</script>