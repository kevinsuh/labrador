(function() {
	
	/**
	 * this controller is what will handle the queue wizard process
	 */
	var app = angular.module('queue-wizard').controller("QueueWizardController", function($rootScope, $scope, $state, $stateParams, $timeout, recipients, cards, usSpinnerService) {
				
		// load in user and relationships factories
    $scope.recipients = recipients;
    $scope.selectedRecipients = recipients.selectedRecipients; // selected recipients is simply passed in from the overarching controller that encompasses this UIRouter view as well as my people UIRouter view.
    // this view uses the same recipients model to transfer data
    $scope.stateParams = $stateParams;
    $scope.occasions = cards.occasions;
    $scope.testRecipient = $scope.selectedRecipients[0];
    $scope.newCard = cards.newCard;

    console.log(recipients.selectedRecipients);
    console.log($state.current);

    $scope.recipientNames = function() {
    	
    	recipients = $scope.selectedRecipients;
    	recipient_names = recipients.map(function(elem) {
    		return elem.first_name;
    	});

    	if (recipient_names.length > 0) {
				
				text        = '';
				conjunction = "and";
				comma       = '';
				ctr         = 1;
				max_names   = 4; // max # of names to show before we default to "others"
				
				keepGoing   = true;
    		angular.forEach(recipient_names, function(value) {

    			if (keepGoing) {

    				// this is where you will add the final value
	    			if (ctr == max_names) {
	    				keepGoing = false;

							remaining_count = (recipient_names.length+1) - ctr;
							other           = remaining_count > 1 ? "others" : "other";
							comma           += conjunction+' ';
							text            += comma + " " + remaining_count + " " + other;

	    			} else {

	    				text += comma+value;
							ctr++;
							if(recipient_names.length > 2){
								comma = ', ';
							} else {
								comma = ' ';
							}
							if(ctr == recipient_names.length) {
								comma += conjunction+' ';
							}
	    			}

    			}
				})
    	}
    	return text;
    }


    // control what happens on each state of UI-Router
    $scope.$on('$stateChangeSuccess',
		  function(event, toState) {
		    $scope.currentState = toState.name;
		  }
		)

    // run more extensive tests here
		$scope.wizardStateisValid = function() {
			return true;
		}

		// get the next step for the wizard form
		$scope.nextStep = function() {
			currentState = $scope.currentState;
			switch(currentState) {
				case "queue.home.step1":
					$state.go("queue.home.step2");
					break;
				case "queue.home.step2":
					$state.go("queue.home.step3");
					break;
				case "queue.home.step3":
					$state.go("queue.home.step4");
					break;
				case "queue.home.step4":
					break;
			}
		}

		// get previous step for the wizard form
		$scope.previousStep = function() {
			currentState = $scope.currentState;
			switch(currentState) {
				case "queue.home.step1":
					break;
				case "queue.home.step2":
					$state.go("queue.home.step1");
					break;
				case "queue.home.step3":
					$state.go("queue.home.step2");
					break;
				case "queue.home.step4":
					$state.go("queue.home.step3");
					break;
			}
		}
		
	});

})();